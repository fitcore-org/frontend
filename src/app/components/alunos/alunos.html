<div class="page-container">
  <h1 class="page-title">Alunos</h1>
  
  <div class="filter-container">
    <button class="btn-primary" (click)="openCreateStudentModal()">
      <i class="icon-plus"></i> Novo Aluno
    </button>
    <input type="text" 
           [(ngModel)]="studentSearch" 
           placeholder="Buscar aluno por nome..." 
           class="search-input">
  </div>
  
  <div class="students-container">
    @for (student of filteredStudents(); track student.id) {
      <div class="student-card">
        <h3>{{ student.name }}</h3>
        <div class="profile-image-container">
          <img [src]="getProfileImage(student.profileUrl)" alt="Foto do aluno" class="profile-image">
        </div>
        <p><strong>CPF:</strong> {{ student.cpf }}</p>
        <p><strong>Telefone:</strong> {{ student.phone }}</p>
        <p><strong>Email:</strong> {{ student.email }}</p>
        <div class="card-actions">
          <button class="btn-read-more" (click)="openStudentModal(student)">Ver Detalhes</button>
          <button class="btn-edit" (click)="openEditStudentModal(student)">Editar</button>
          <button class="btn-delete" (click)="deleteStudent(student)">Excluir</button>
        </div>
      </div>
    }
    @if (filteredStudents().length === 0) {
      <p class="no-results">Nenhum aluno encontrado.</p>
    }
  </div>
</div>

@if (isStudentModalOpen && selectedStudent) {
  <div class="modal-overlay" (click)="closeStudentModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ selectedStudent.name }}</h2>
        <button class="close-btn" (click)="closeStudentModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="profile-section">
          <img [src]="getProfileImage(selectedStudent.profileUrl)" alt="Foto do aluno" class="modal-profile-image">
          <div class="profile-info">
            <p><strong>Email:</strong> {{ selectedStudent.email }}</p>
            <p><strong>CPF:</strong> {{ selectedStudent.cpf }}</p>
            <p><strong>Data de Nascimento:</strong> {{ selectedStudent.birthDate | date:'dd/MM/yyyy' }}</p>
            <p><strong>Telefone:</strong> {{ selectedStudent.phone }}</p>
            <p><strong>Status:</strong> 
              <span [class]="selectedStudent.active ? 'status-active' : 'status-inactive'">
                {{ selectedStudent.active ? 'Ativo' : 'Inativo' }}
              </span>
            </p>
          </div>
        </div>
        
        <div class="plan-section">
          <h3>Informações do Plano</h3>
          <p><strong>Tipo de Plano:</strong> {{ selectedStudent.planType }}</p>
          <p><strong>Descrição:</strong> {{ selectedStudent.planDescription }}</p>
          <p><strong>Data de Registro:</strong> {{ selectedStudent.registrationDate | date:'dd/MM/yyyy' }}</p>
        </div>
        
        <div class="physical-section">
          <h3>Informações Físicas</h3>
          <p><strong>Peso:</strong> {{ selectedStudent.weight }}kg</p>
          <p><strong>Altura:</strong> {{ selectedStudent.height }}cm</p>
          <p><strong>IMC:</strong> {{ selectedStudent.bmi | number:'1.1-1' }}</p>
        </div>
      </div>
    </div>
  </div>
}

<!-- Modal para Criar Aluno -->
@if (isCreateStudentModalOpen) {
  <div class="modal-overlay" (click)="closeCreateStudentModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Novo Aluno</h2>
        <button class="close-btn" (click)="closeCreateStudentModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="createStudent()" #createForm="ngForm">
          <div class="form-row">
            <div class="form-group">
              <label for="name">Nome *</label>
              <input type="text" 
                     id="name" 
                     [(ngModel)]="newStudent.name" 
                     name="name" 
                     required 
                     class="form-control">
            </div>
            <div class="form-group">
              <label for="email">Email *</label>
              <input type="email" 
                     id="email" 
                     [(ngModel)]="newStudent.email" 
                     name="email" 
                     required 
                     class="form-control">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="cpf">CPF *</label>
              <input type="text" 
                     id="cpf" 
                     [(ngModel)]="newStudent.cpf" 
                     name="cpf" 
                     required 
                     class="form-control"
                     placeholder="000.000.000-00">
            </div>
            <div class="form-group">
              <label for="birthDate">Data de Nascimento *</label>
              <input type="date" 
                     id="birthDate" 
                     [(ngModel)]="newStudent.birthDate" 
                     name="birthDate" 
                     required 
                     class="form-control">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="phone">Telefone *</label>
              <input type="text" 
                     id="phone" 
                     [(ngModel)]="newStudent.phone" 
                     name="phone" 
                     required 
                     class="form-control"
                     placeholder="(00) 00000-0000">
            </div>
            <div class="form-group">
              <label for="planType">Tipo de Plano *</label>
              <input type="text" 
                     id="planType" 
                     [(ngModel)]="newStudent.planType" 
                     name="planType" 
                     required 
                     class="form-control"
                     placeholder="Ex: Mensal, Anual, etc.">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="weight">Peso (kg) *</label>
              <input type="number" 
                     id="weight" 
                     [(ngModel)]="newStudent.weight" 
                     name="weight" 
                     required 
                     min="0.1" 
                     step="0.1" 
                     class="form-control">
            </div>
            <div class="form-group">
              <label for="height">Altura (cm) *</label>
              <input type="number" 
                     id="height" 
                     [(ngModel)]="newStudent.height" 
                     name="height" 
                     required 
                     min="1" 
                     class="form-control">
            </div>
          </div>
          
          <div class="modal-actions">
            <button type="button" class="btn-secondary" (click)="closeCreateStudentModal()">Cancelar</button>
            <button type="submit" 
                    class="btn-primary" 
                    [disabled]="isCreatingStudent || !createForm.form.valid">
              {{ isCreatingStudent ? 'Criando...' : 'Criar Aluno' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
}

<!-- Modal para Editar Aluno -->
@if (isEditStudentModalOpen && editingStudent) {
  <div class="modal-overlay" (click)="closeEditStudentModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Editar Aluno</h2>
        <button class="close-btn" (click)="closeEditStudentModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updateStudent()" #editForm="ngForm">
          <div class="form-row">
            <div class="form-group">
              <label for="editName">Nome *</label>
              <input type="text" 
                     id="editName" 
                     [(ngModel)]="updatedStudent.name" 
                     name="editName" 
                     required 
                     class="form-control">
            </div>
            <div class="form-group">
              <label for="editEmail">Email *</label>
              <input type="email" 
                     id="editEmail" 
                     [(ngModel)]="updatedStudent.email" 
                     name="editEmail" 
                     required 
                     class="form-control">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="editPhone">Telefone *</label>
              <input type="text" 
                     id="editPhone" 
                     [(ngModel)]="updatedStudent.phone" 
                     name="editPhone" 
                     required 
                     class="form-control">
            </div>
            <div class="form-group">
              <label for="editPlanType">Tipo de Plano *</label>
              <input type="text" 
                     id="editPlanType" 
                     [(ngModel)]="updatedStudent.planType" 
                     name="editPlanType" 
                     required 
                     class="form-control">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="editWeight">Peso (kg) *</label>
              <input type="number" 
                     id="editWeight" 
                     [(ngModel)]="updatedStudent.weight" 
                     name="editWeight" 
                     required 
                     min="0.1" 
                     step="0.1" 
                     class="form-control">
            </div>
            <div class="form-group">
              <label for="editHeight">Altura (cm) *</label>
              <input type="number" 
                     id="editHeight" 
                     [(ngModel)]="updatedStudent.height" 
                     name="editHeight" 
                     required 
                     min="1" 
                     class="form-control">
            </div>
          </div>
          
          <div class="modal-actions">
            <button type="button" class="btn-secondary" (click)="closeEditStudentModal()">Cancelar</button>
            <button type="submit" 
                    class="btn-primary" 
                    [disabled]="isUpdatingStudent || !editForm.form.valid">
              {{ isUpdatingStudent ? 'Atualizando...' : 'Atualizar Aluno' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
}
