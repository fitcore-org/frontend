<div class="page-container">
  <div class="page-header">
    <h1 class="page-title">Treinos Dispon√≠veis</h1>
  </div>
  
  <div class="filter-container">
    <input 
      type="text" 
      class="search-input" 
      placeholder="Buscar treinos por nome, descri√ß√£o ou grupo muscular..."
      [(ngModel)]="workoutSearch"
    >
  </div>

  <!-- Se√ß√£o de Treinos P√∫blicos -->
  <div class="workout-section" *ngIf="getFilteredPublicWorkouts().length > 0">
    <div class="section-header">
      <h2 class="section-title">Treinos P√∫blicos</h2>
      <button class="btn-create-workout" (click)="openCreateWorkoutModal()">
        Criar Treino P√∫blico
      </button>
    </div>
    <div class="workouts-container">
      <div 
        *ngFor="let workout of getFilteredPublicWorkouts()" 
        class="workout-card"
      >
        <div class="workout-header">
          <h3>{{ workout.name }}</h3>
          <span class="workout-type public">P√∫blico</span>
        </div>
        
        <p class="workout-description">{{ workout.description }}</p>
        
        <div class="workout-stats">
          <div class="stat">
            <strong>{{ workout.items.length }}</strong> exerc√≠cios
          </div>
          <div class="stat">
            <strong>{{ calculateTotalSets(workout) }}</strong> s√©ries
          </div>
          <div class="stat">
            <strong>{{ getMainMuscleGroups(workout) }}</strong>
          </div>
        </div>
        
        <div class="exercise-preview">
          <div *ngFor="let item of workout.items.slice(0, 3)" class="exercise-item">
            <span class="exercise-name">{{ item.exercise.name }}</span>
            <span class="exercise-sets">{{ item.sets }}x{{ item.reps }}</span>
          </div>
          <div *ngIf="workout.items.length > 3" class="more-exercises">
            +{{ workout.items.length - 3 }} exerc√≠cios
          </div>
        </div>
        
        <div class="workout-actions">
          <button class="btn-view-workout" (click)="openWorkoutModal(workout)">
            Ver Treino Completo
          </button>
          <div class="workout-secondary-actions">
            <button class="btn-edit-workout" (click)="openEditWorkoutModal(workout); $event.stopPropagation()">
              ‚úèÔ∏è Editar
            </button>
            <button class="btn-delete-workout" (click)="deleteWorkout(workout.id, workout.name); $event.stopPropagation()">
              üóëÔ∏è Deletar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Se√ß√£o de Treinos Privados -->
  <div class="workout-section" *ngIf="getFilteredPrivateWorkouts().length > 0">
    <h2 class="section-title">Treinos Privados</h2>
    <div class="workouts-container">
      <div 
        *ngFor="let workout of getFilteredPrivateWorkouts()" 
        class="workout-card"
      >
        <div class="workout-header">
          <h3>{{ workout.name }}</h3>
          <span class="workout-type private">Privado</span>
        </div>
        
        <p class="workout-description">{{ workout.description }}</p>
        
        <div class="workout-stats">
          <div class="stat">
            <strong>{{ workout.items.length }}</strong> exerc√≠cios
          </div>
          <div class="stat">
            <strong>{{ calculateTotalSets(workout) }}</strong> s√©ries
          </div>
          <div class="stat">
            <strong>{{ getMainMuscleGroups(workout) }}</strong>
          </div>
        </div>
        
        <div class="exercise-preview">
          <div *ngFor="let item of workout.items.slice(0, 3)" class="exercise-item">
            <span class="exercise-name">{{ item.exercise.name }}</span>
            <span class="exercise-sets">{{ item.sets }}x{{ item.reps }}</span>
          </div>
          <div *ngIf="workout.items.length > 3" class="more-exercises">
            +{{ workout.items.length - 3 }} exerc√≠cios
          </div>
        </div>
        
        <div class="workout-actions">
          <button class="btn-view-workout" (click)="openWorkoutModal(workout)">
            Ver Treino Completo
          </button>
          <div class="workout-secondary-actions">
            <button class="btn-edit-workout" (click)="openEditWorkoutModal(workout); $event.stopPropagation()">
              ‚úèÔ∏è Editar
            </button>
            <button class="btn-delete-workout" (click)="deleteWorkout(workout.id, workout.name); $event.stopPropagation()">
              üóëÔ∏è Deletar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="no-results" *ngIf="getFilteredPublicWorkouts().length === 0 && getFilteredPrivateWorkouts().length === 0 && workoutSearch">
    Nenhum treino encontrado para "{{ workoutSearch }}"
  </div>

  <div class="no-results" *ngIf="getAllWorkouts().length === 0 && !workoutSearch">
    Nenhum treino dispon√≠vel no momento.
  </div>
</div>

<!-- Modal para criar treino -->
<div class="modal-overlay" *ngIf="showCreateWorkoutModal" (click)="closeCreateWorkoutModal()">
  <div class="modal-content create-workout-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Criar Novo Treino P√∫blico</h2>
      <button class="close-btn" (click)="closeCreateWorkoutModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <form (ngSubmit)="createWorkout()" #workoutForm="ngForm">
        <div class="form-group">
          <label for="workoutName">Nome do Treino</label>
          <input 
            type="text" 
            id="workoutName"
            class="form-input" 
            [(ngModel)]="newWorkout.name"
            name="workoutName"
            required
            placeholder="Digite o nome do treino"
          >
        </div>
        
        <div class="form-group">
          <label for="workoutDescription">Descri√ß√£o</label>
          <textarea 
            id="workoutDescription"
            class="form-textarea" 
            [(ngModel)]="newWorkout.description"
            name="workoutDescription"
            required
            placeholder="Descreva o treino"
            rows="3"
          ></textarea>
        </div>
        
        <div class="exercise-selection">
          <h3>Selecionar Exerc√≠cios</h3>
          
          <div class="exercise-search">
            <input 
              type="text" 
              class="search-input" 
              placeholder="Buscar exerc√≠cios..."
              [(ngModel)]="exerciseSearch"
              name="exerciseSearch"
            >
          </div>
          
          <div class="available-exercises">
            <h4>Exerc√≠cios Dispon√≠veis</h4>
            <div class="exercises-list">
              <div 
                *ngFor="let exercise of getFilteredExercises()" 
                class="exercise-item selectable"
                (click)="addExerciseToWorkout(exercise)"
              >
                <div class="exercise-info">
                  <span class="exercise-name">{{ exercise.name }}</span>
                  <span class="muscle-group">{{ exercise.muscleGroup | titlecase }}</span>
                </div>
                <button type="button" class="btn-add">+</button>
              </div>
            </div>
          </div>
          
          <div class="selected-exercises" *ngIf="newWorkout.items.length > 0">
            <h4>Exerc√≠cios Selecionados ({{ newWorkout.items.length }})</h4>
            <div class="workout-exercises">
              <div 
                *ngFor="let item of newWorkout.items; let i = index" 
                class="workout-exercise-item"
              >
                <div class="exercise-order">
                  <button 
                    type="button" 
                    class="btn-order" 
                    (click)="moveExercise(i, -1)"
                    [disabled]="i === 0"
                  >‚Üë</button>
                  <span class="order-number">{{ i + 1 }}</span>
                  <button 
                    type="button" 
                    class="btn-order" 
                    (click)="moveExercise(i, 1)"
                    [disabled]="i === newWorkout.items.length - 1"
                  >‚Üì</button>
                </div>
                
                <div class="exercise-details">
                  <div class="exercise-name">{{ getExerciseById(item.exerciseId)?.name }}</div>
                  <div class="exercise-params">
                    <div class="param-group">
                      <label>S√©ries:</label>
                      <input 
                        type="number" 
                        min="1" 
                        [(ngModel)]="item.sets"
                        name="sets_{{i}}"
                        class="param-input"
                        required
                      >
                    </div>
                    <div class="param-group">
                      <label>Reps:</label>
                      <input 
                        type="text" 
                        [(ngModel)]="item.reps"
                        name="reps_{{i}}"
                        class="param-input"
                        placeholder="8-12"
                        required
                      >
                    </div>
                    <div class="param-group">
                      <label>Descanso (s):</label>
                      <input 
                        type="number" 
                        min="0" 
                        [(ngModel)]="item.restSeconds"
                        name="rest_{{i}}"
                        class="param-input"
                        required
                      >
                    </div>
                  </div>
                  <div class="observation-group">
                    <label>Observa√ß√£o:</label>
                    <input 
                      type="text" 
                      [(ngModel)]="item.observation"
                      name="observation_{{i}}"
                      class="param-input"
                      placeholder="Observa√ß√µes opcionais"
                    >
                  </div>
                </div>
                
                <button 
                  type="button" 
                  class="btn-remove" 
                  (click)="removeExerciseFromWorkout(i)"
                >√ó</button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button 
            type="button" 
            class="btn-cancel" 
            (click)="closeCreateWorkoutModal()"
          >
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn-create" 
            [disabled]="!workoutForm.valid || newWorkout.items.length === 0"
          >
            Criar Treino
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal para exibir detalhes do treino -->
<div class="modal-overlay" *ngIf="selectedWorkout" (click)="closeWorkoutModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ selectedWorkout.name }}</h2>
      <button class="close-btn" (click)="closeWorkoutModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <div class="workout-overview">
        <p class="workout-description">{{ selectedWorkout.description }}</p>
        
        <div class="workout-summary">
          <div class="summary-item">
            <strong>Total de exerc√≠cios:</strong> {{ selectedWorkout.items.length }}
          </div>
          <div class="summary-item">
            <strong>Total de s√©ries:</strong> {{ calculateTotalSets(selectedWorkout) }}
          </div>
          <div class="summary-item">
            <strong>Grupos musculares:</strong> {{ getMainMuscleGroups(selectedWorkout) }}
          </div>
          <div class="summary-item">
            <strong>Tempo estimado:</strong> {{ calculateEstimatedTime(selectedWorkout) }} min
          </div>
        </div>
      </div>

      <div class="modal-workout-actions">
        <button class="btn-edit-workout-modal" (click)="openEditWorkoutModal(selectedWorkout!)">
          ‚úèÔ∏è Editar Treino
        </button>
        <button class="btn-delete-workout-modal" (click)="deleteWorkout(selectedWorkout.id, selectedWorkout.name)">
          üóëÔ∏è Deletar Treino
        </button>
      </div>

      <h3>Exerc√≠cios do Treino</h3>
      
      <div class="exercises-list">
        <div *ngFor="let item of selectedWorkout.items" class="exercise-detail">
          <div class="exercise-header">
            <span class="exercise-order">{{ item.order }}</span>
            <div class="exercise-info">
              <h4>{{ item.exercise.name }}</h4>
              <p class="muscle-group">{{ item.exercise.muscleGroup | titlecase }}</p>
            </div>
          </div>
          
          <div class="exercise-images" *ngIf="item.exercise.mediaUrl || item.exercise.mediaUrl2">
            <img 
              *ngIf="item.exercise.mediaUrl" 
              [src]="item.exercise.mediaUrl" 
              [alt]="item.exercise.name + ' - posi√ß√£o inicial'"
              class="exercise-image"
            >
            <img 
              *ngIf="item.exercise.mediaUrl2" 
              [src]="item.exercise.mediaUrl2" 
              [alt]="item.exercise.name + ' - execu√ß√£o'"
              class="exercise-image"
            >
          </div>
          
          <div class="exercise-specs">
            <div class="spec">
              <strong>S√©ries:</strong> {{ item.sets }}
            </div>
            <div class="spec">
              <strong>Repeti√ß√µes:</strong> {{ item.reps }}
            </div>
            <div class="spec">
              <strong>Descanso:</strong> {{ item.restSeconds }}s
            </div>
            <div class="spec">
              <strong>Equipamento:</strong> {{ item.exercise.equipment }}
            </div>
          </div>
          
          <div class="exercise-description">
            <p><strong>Descri√ß√£o:</strong> {{ item.exercise.description }}</p>
          </div>
          
          <div class="exercise-observation" *ngIf="item.observation">
            <p><strong>Observa√ß√£o:</strong> {{ item.observation }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para editar treino -->
<div class="modal-overlay" *ngIf="showEditWorkoutModal" (click)="closeEditWorkoutModal()">
  <div class="modal-content create-workout-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Editar Treino</h2>
      <button class="close-btn" (click)="closeEditWorkoutModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <form (ngSubmit)="updateWorkout()" #editWorkoutForm="ngForm">
        <div class="form-group">
          <label for="editWorkoutName">Nome do Treino</label>
          <input 
            type="text" 
            id="editWorkoutName"
            class="form-input" 
            [(ngModel)]="editWorkout.name"
            name="editWorkoutName"
            required
            placeholder="Digite o nome do treino"
          >
        </div>
        
        <div class="form-group">
          <label for="editWorkoutDescription">Descri√ß√£o</label>
          <textarea 
            id="editWorkoutDescription"
            class="form-textarea" 
            [(ngModel)]="editWorkout.description"
            name="editWorkoutDescription"
            required
            placeholder="Descreva o treino"
            rows="3"
          ></textarea>
        </div>
        
        <div class="exercise-selection">
          <h3>Editar Exerc√≠cios</h3>
          
          <div class="exercise-search">
            <input 
              type="text" 
              class="search-input" 
              placeholder="Buscar exerc√≠cios..."
              [(ngModel)]="exerciseSearch"
              name="exerciseSearchEdit"
            >
          </div>
          
          <div class="available-exercises">
            <h4>Exerc√≠cios Dispon√≠veis</h4>
            <div class="exercises-list">
              <div 
                *ngFor="let exercise of getFilteredExercises()" 
                class="exercise-item selectable"
                (click)="addExerciseToEditWorkout(exercise)"
              >
                <div class="exercise-info">
                  <span class="exercise-name">{{ exercise.name }}</span>
                  <span class="muscle-group">{{ exercise.muscleGroup | titlecase }}</span>
                </div>
                <button type="button" class="btn-add">+</button>
              </div>
            </div>
          </div>
          
          <div class="selected-exercises" *ngIf="editWorkout.items.length > 0">
            <h4>Exerc√≠cios Selecionados ({{ editWorkout.items.length }})</h4>
            <div class="workout-exercises">
              <div 
                *ngFor="let item of editWorkout.items; let i = index" 
                class="workout-exercise-item"
              >
                <div class="exercise-order">
                  <button 
                    type="button" 
                    class="btn-order" 
                    (click)="moveExerciseInEdit(i, -1)"
                    [disabled]="i === 0"
                  >‚Üë</button>
                  <span class="order-number">{{ i + 1 }}</span>
                  <button 
                    type="button" 
                    class="btn-order" 
                    (click)="moveExerciseInEdit(i, 1)"
                    [disabled]="i === editWorkout.items.length - 1"
                  >‚Üì</button>
                </div>
                
                <div class="exercise-details">
                  <div class="exercise-name">{{ getExerciseById(item.exerciseId)?.name }}</div>
                  <div class="exercise-params">
                    <div class="param-group">
                      <label>S√©ries:</label>
                      <input 
                        type="number" 
                        min="1" 
                        [(ngModel)]="item.sets"
                        name="edit_sets_{{i}}"
                        class="param-input"
                        required
                      >
                    </div>
                    <div class="param-group">
                      <label>Reps:</label>
                      <input 
                        type="text" 
                        [(ngModel)]="item.reps"
                        name="edit_reps_{{i}}"
                        class="param-input"
                        placeholder="8-12"
                        required
                      >
                    </div>
                    <div class="param-group">
                      <label>Descanso (s):</label>
                      <input 
                        type="number" 
                        min="0" 
                        [(ngModel)]="item.restSeconds"
                        name="edit_rest_{{i}}"
                        class="param-input"
                        required
                      >
                    </div>
                  </div>
                  <div class="observation-group">
                    <label>Observa√ß√£o:</label>
                    <input 
                      type="text" 
                      [(ngModel)]="item.observation"
                      name="edit_observation_{{i}}"
                      class="param-input"
                      placeholder="Observa√ß√µes opcionais"
                    >
                  </div>
                </div>
                
                <button 
                  type="button" 
                  class="btn-remove" 
                  (click)="removeExerciseFromEditWorkout(i)"
                >√ó</button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button 
            type="button" 
            class="btn-cancel" 
            (click)="closeEditWorkoutModal()"
          >
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn-update" 
            [disabled]="!editWorkoutForm.valid || editWorkout.items.length === 0"
          >
            Atualizar Treino
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
