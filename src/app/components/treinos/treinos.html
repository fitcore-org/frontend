<div class="page-container">
  <div class="page-header">
    <h1 class="page-title">Treinos Disponíveis</h1>
  </div>
  
  <div class="filter-container">
    <input 
      type="text" 
      class="search-input" 
      placeholder="Buscar treinos por nome, descrição ou grupo muscular..."
      [(ngModel)]="workoutSearch"
    >
  </div>

  <!-- Seção de Treinos Públicos -->
  <div class="workout-section" *ngIf="getFilteredPublicWorkouts().length > 0">
    <div class="section-header">
      <h2 class="section-title">Treinos Públicos</h2>
      <button class="btn-create-workout" (click)="openCreateWorkoutModal()">
        Criar Treino Público
      </button>
    </div>
    <div class="workouts-container">
      <div 
        *ngFor="let workout of getFilteredPublicWorkouts()" 
        class="workout-card"
      >
        <div class="workout-header">
          <h3>{{ workout.name }}</h3>
          <span class="workout-type public">Público</span>
        </div>
        
        <p class="workout-description">{{ workout.description }}</p>
        
        <div class="workout-stats">
          <div class="stat">
            <strong>{{ workout.items.length }}</strong> exercícios
          </div>
          <div class="stat">
            <strong>{{ calculateTotalSets(workout) }}</strong> séries
          </div>
          <div class="stat">
            <strong>{{ getMainMuscleGroups(workout) }}</strong>
          </div>
        </div>
        
        <div class="exercise-preview">
          <div *ngFor="let item of workout.items.slice(0, 3)" class="exercise-item">
            <span class="exercise-name">{{ item.exercise.name }}</span>
            <span class="exercise-sets">{{ item.sets }}x{{ item.reps }}</span>
          </div>
          <div *ngIf="workout.items.length > 3" class="more-exercises">
            +{{ workout.items.length - 3 }} exercícios
          </div>
        </div>
        
        <div class="workout-actions">
          <button class="btn-view-workout" (click)="openWorkoutModal(workout)">
            Ver Treino Completo
          </button>
          <div class="workout-secondary-actions">
            <button class="btn-edit-workout" (click)="openEditWorkoutModal(workout); $event.stopPropagation()">
              <img src="edit.svg" alt="Editar" width="16" height="16"> Editar
            </button>
            <button class="btn-delete-workout" (click)="deleteWorkout(workout.id, workout.name); $event.stopPropagation()">
              <img src="delete.svg" alt="Deletar" width="16" height="16"> Deletar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Seção de Treinos Privados -->
  <div class="workout-section" *ngIf="getFilteredPrivateWorkouts().length > 0">
    <div class="section-header">
      <h2 class="section-title">Treinos Privados</h2>
      <button class="btn-create-workout" (click)="openCreatePrivateWorkoutModal()">
        Criar Treino Privado
      </button>
    </div>
    <div class="workouts-container">
      <div 
        *ngFor="let workout of getFilteredPrivateWorkouts()" 
        class="workout-card"
      >
        <div class="workout-header">
          <h3>{{ workout.name }}</h3>
          <span class="workout-type private">Privado</span>
        </div>
        
        <p class="workout-description">{{ workout.description }}</p>
        
        <div class="workout-stats">
          <div class="stat">
            <strong>{{ workout.items.length }}</strong> exercícios
          </div>
          <div class="stat">
            <strong>{{ calculateTotalSets(workout) }}</strong> séries
          </div>
          <div class="stat">
            <strong>{{ getMainMuscleGroups(workout) }}</strong>
          </div>
          <div class="stat">
            <strong>{{ workout.studentIds.length }}</strong> aluno(s)
          </div>
        </div>

        <!-- Seção dos alunos com acesso -->
        <div class="workout-students" *ngIf="workout.studentIds.length > 0">
          <h4>Alunos com acesso:</h4>
          <div class="students-list">
            <span 
              *ngFor="let studentId of workout.studentIds.slice(0, 3)" 
              class="student-name"
            >
              {{ getStudentById(studentId)?.name || 'Nome não encontrado' }}
            </span>
            <span *ngIf="workout.studentIds.length > 3" class="more-students">
              +{{ workout.studentIds.length - 3 }} aluno(s)
            </span>
          </div>
        </div>
        
        <div class="exercise-preview">
          <div *ngFor="let item of workout.items.slice(0, 3)" class="exercise-item">
            <span class="exercise-name">{{ item.exercise.name }}</span>
            <span class="exercise-sets">{{ item.sets }}x{{ item.reps }}</span>
          </div>
          <div *ngIf="workout.items.length > 3" class="more-exercises">
            +{{ workout.items.length - 3 }} exercícios
          </div>
        </div>
        
        <div class="workout-actions">
          <button class="btn-view-workout" (click)="openWorkoutModal(workout)">
            Ver Treino Completo
          </button>
          <div class="workout-secondary-actions">
            <button class="btn-manage-students" (click)="openStudentManagementModal(workout); $event.stopPropagation()">
              Alunos
            </button>
            <button class="btn-edit-workout" (click)="openEditWorkoutModal(workout); $event.stopPropagation()">
              <img src="edit.svg" alt="Editar" width="16" height="16"> Editar
            </button>
            <button class="btn-delete-workout" (click)="deleteWorkout(workout.id, workout.name); $event.stopPropagation()">
              <img src="delete.svg" alt="Deletar" width="16" height="16"> Deletar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Seção de Treinos Privados quando não há treinos -->
  <div class="workout-section" *ngIf="getFilteredPrivateWorkouts().length === 0 && !workoutSearch">
    <div class="section-header">
      <h2 class="section-title">Treinos Privados</h2>
      <button class="btn-create-workout" (click)="openCreatePrivateWorkoutModal()">
        Criar Treino Privado
      </button>
    </div>
    <div class="no-results">
      Nenhum treino privado disponível no momento.
    </div>
  </div>

  <div class="no-results" *ngIf="getFilteredPublicWorkouts().length === 0 && getFilteredPrivateWorkouts().length === 0 && workoutSearch">
    Nenhum treino encontrado para "{{ workoutSearch }}"
  </div>

  <div class="no-results" *ngIf="getAllWorkouts().length === 0 && !workoutSearch">
    Nenhum treino disponível no momento.
  </div>
</div>

<!-- Modal para criar treino -->
<div class="modal-overlay" *ngIf="showCreateWorkoutModal" (click)="closeCreateWorkoutModal()">
  <div class="modal-content create-workout-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Criar Novo Treino Público</h2>
      <button class="close-btn" (click)="closeCreateWorkoutModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <form (ngSubmit)="createWorkout()" #workoutForm="ngForm">
        <div class="form-group">
          <label for="workoutName">Nome do Treino</label>
          <input 
            type="text" 
            id="workoutName"
            class="form-input" 
            [(ngModel)]="newWorkout.name"
            name="workoutName"
            required
            placeholder="Digite o nome do treino"
          >
        </div>
        
        <div class="form-group">
          <label for="workoutDescription">Descrição</label>
          <textarea 
            id="workoutDescription"
            class="form-textarea" 
            [(ngModel)]="newWorkout.description"
            name="workoutDescription"
            required
            placeholder="Descreva o treino"
            rows="3"
          ></textarea>
        </div>
        
        <div class="exercise-selection">
          <h3>Selecionar Exercícios</h3>
          
          <div class="exercise-search">
            <input 
              type="text" 
              class="search-input" 
              placeholder="Buscar exercícios..."
              [(ngModel)]="exerciseSearch"
              name="exerciseSearch"
            >
          </div>
          
          <div class="available-exercises">
            <h4>Exercícios Disponíveis</h4>
            <div class="exercises-list">
              <div 
                *ngFor="let exercise of getFilteredExercises()" 
                class="exercise-item selectable"
                (click)="addExerciseToWorkout(exercise)"
              >
                <div class="exercise-info">
                  <span class="exercise-name">{{ exercise.name }}</span>
                  <span class="muscle-group">{{ exercise.muscleGroup | titlecase }}</span>
                </div>
                <button type="button" class="btn-add">+</button>
              </div>
            </div>
          </div>
          
          <div class="selected-exercises" *ngIf="newWorkout.items.length > 0">
            <h4>Exercícios Selecionados ({{ newWorkout.items.length }})</h4>
            <div class="workout-exercises">
              <div 
                *ngFor="let item of newWorkout.items; let i = index" 
                class="workout-exercise-item"
              >
                <div class="exercise-order">
                  <button 
                    type="button" 
                    class="btn-order" 
                    (click)="moveExercise(i, -1)"
                    [disabled]="i === 0"
                  >↑</button>
                  <span class="order-number">{{ i + 1 }}</span>
                  <button 
                    type="button" 
                    class="btn-order" 
                    (click)="moveExercise(i, 1)"
                    [disabled]="i === newWorkout.items.length - 1"
                  >↓</button>
                </div>
                
                <div class="exercise-details">
                  <div class="exercise-name">{{ getExerciseById(item.exerciseId)?.name }}</div>
                  <div class="exercise-params">
                    <div class="param-group">
                      <label>Séries:</label>
                      <input 
                        type="number" 
                        min="1" 
                        [(ngModel)]="item.sets"
                        name="sets_{{i}}"
                        class="param-input"
                        required
                      >
                    </div>
                    <div class="param-group">
                      <label>Reps:</label>
                      <input 
                        type="text" 
                        [(ngModel)]="item.reps"
                        name="reps_{{i}}"
                        class="param-input"
                        placeholder="8-12"
                        required
                      >
                    </div>
                    <div class="param-group">
                      <label>Descanso (s):</label>
                      <input 
                        type="number" 
                        min="0" 
                        [(ngModel)]="item.restSeconds"
                        name="rest_{{i}}"
                        class="param-input"
                        required
                      >
                    </div>
                  </div>
                  <div class="observation-group">
                    <label>Observação:</label>
                    <input 
                      type="text" 
                      [(ngModel)]="item.observation"
                      name="observation_{{i}}"
                      class="param-input"
                      placeholder="Observações opcionais"
                    >
                  </div>
                </div>
                
                <button 
                  type="button" 
                  class="btn-remove" 
                  (click)="removeExerciseFromWorkout(i)"
                >×</button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button 
            type="button" 
            class="btn-cancel" 
            (click)="closeCreateWorkoutModal()"
          >
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn-create" 
            [disabled]="!workoutForm.valid || newWorkout.items.length === 0"
          >
            Criar Treino
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal para exibir detalhes do treino -->
<div class="modal-overlay" *ngIf="selectedWorkout" (click)="closeWorkoutModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ selectedWorkout.name }}</h2>
      <button class="close-btn" (click)="closeWorkoutModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <div class="workout-overview">
        <p class="workout-description">{{ selectedWorkout.description }}</p>
        
        <div class="workout-summary">
          <div class="summary-item">
            <strong>Total de exercícios:</strong> {{ selectedWorkout.items.length }}
          </div>
          <div class="summary-item">
            <strong>Total de séries:</strong> {{ calculateTotalSets(selectedWorkout) }}
          </div>
          <div class="summary-item">
            <strong>Grupos musculares:</strong> {{ getMainMuscleGroups(selectedWorkout) }}
          </div>
          <div class="summary-item">
            <strong>Tempo estimado:</strong> {{ calculateEstimatedTime(selectedWorkout) }} min
          </div>
        </div>
      </div>

      <div class="modal-workout-actions">
        <button class="btn-edit-workout-modal" (click)="openEditWorkoutModal(selectedWorkout!)">
          <img src="edit.svg" alt="Editar" width="16" height="16"> Editar Treino
        </button>
        <button class="btn-delete-workout-modal" (click)="deleteWorkout(selectedWorkout.id, selectedWorkout.name)">
          <img src="delete.svg" alt="Deletar" width="16" height="16"> Deletar Treino
        </button>
      </div>

      <h3>Exercícios do Treino</h3>
      
      <div class="exercises-list">
        <div *ngFor="let item of selectedWorkout.items" class="exercise-detail">
          <div class="exercise-header">
            <span class="exercise-order">{{ item.order }}</span>
            <div class="exercise-info">
              <h4>{{ item.exercise.name }}</h4>
              <p class="muscle-group">{{ item.exercise.muscleGroup | titlecase }}</p>
            </div>
          </div>
          
          <div class="exercise-images" *ngIf="item.exercise.mediaUrl || item.exercise.mediaUrl2">
            <img 
              *ngIf="item.exercise.mediaUrl" 
              [src]="item.exercise.mediaUrl" 
              [alt]="item.exercise.name + ' - posição inicial'"
              class="exercise-image"
            >
            <img 
              *ngIf="item.exercise.mediaUrl2" 
              [src]="item.exercise.mediaUrl2" 
              [alt]="item.exercise.name + ' - execução'"
              class="exercise-image"
            >
          </div>
          
          <div class="exercise-specs">
            <div class="spec">
              <strong>Séries:</strong> {{ item.sets }}
            </div>
            <div class="spec">
              <strong>Repetições:</strong> {{ item.reps }}
            </div>
            <div class="spec">
              <strong>Descanso:</strong> {{ item.restSeconds }}s
            </div>
            <div class="spec">
              <strong>Equipamento:</strong> {{ item.exercise.equipment }}
            </div>
          </div>
          
          <div class="exercise-description">
            <p><strong>Descrição:</strong> {{ item.exercise.description }}</p>
          </div>
          
          <div class="exercise-observation" *ngIf="item.observation">
            <p><strong>Observação:</strong> {{ item.observation }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para criar treino privado -->
<div class="modal-overlay" *ngIf="showCreatePrivateWorkoutModal" (click)="closeCreatePrivateWorkoutModal()">
  <div class="modal-content create-workout-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Criar Novo Treino Privado</h2>
      <button class="close-btn" (click)="closeCreatePrivateWorkoutModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <form (ngSubmit)="createPrivateWorkout()" #privateWorkoutForm="ngForm">
        <div class="form-group">
          <label for="privateWorkoutName">Nome do Treino</label>
          <input 
            type="text" 
            id="privateWorkoutName"
            class="form-input" 
            [(ngModel)]="newPrivateWorkout.name"
            name="privateWorkoutName"
            required
            placeholder="Digite o nome do treino"
          >
        </div>
        
        <div class="form-group">
          <label for="privateWorkoutDescription">Descrição</label>
          <textarea 
            id="privateWorkoutDescription"
            class="form-textarea" 
            [(ngModel)]="newPrivateWorkout.description"
            name="privateWorkoutDescription"
            required
            placeholder="Descreva o treino"
            rows="3"
          ></textarea>
        </div>

        <div class="student-selection">
          <h3>Selecionar Alunos <span class="required-indicator">(obrigatório - mínimo 1)</span></h3>
          
          <div class="student-search">
            <input 
              type="text" 
              class="search-input" 
              placeholder="Buscar alunos por nome, CPF ou email..."
              [(ngModel)]="studentSearch"
              name="studentSearch"
            >
          </div>

          <!-- Lista de alunos selecionados -->
          <div class="selected-students" *ngIf="getSelectedStudentsForPrivateWorkout().length > 0">
            <h4>Alunos Selecionados ({{ getSelectedStudentsForPrivateWorkout().length }})</h4>
            <div class="students-list-modal">
              <div 
                *ngFor="let student of getSelectedStudentsForPrivateWorkout()" 
                class="student-item"
              >
                <div class="student-info">
                  <div class="student-name">{{ student.name }}</div>
                  <div class="student-details">{{ student.cpf }} • {{ student.email }}</div>
                  <div class="student-plan">{{ student.planType }} - {{ student.planDescription }}</div>
                </div>
                <button 
                  type="button" 
                  class="btn-remove-student" 
                  (click)="removeStudentFromPrivateWorkout(student.id)"
                  title="Remover aluno"
                >
                  ×
                </button>
              </div>
            </div>
          </div>

          <!-- Lista de alunos disponíveis -->
          <div class="available-students">
            <h4>Alunos Disponíveis</h4>
            <div class="students-list-modal" *ngIf="getAvailableStudentsForPrivateWorkout().length > 0">
              <div 
                *ngFor="let student of getAvailableStudentsForPrivateWorkout()" 
                class="student-item selectable"
                (click)="addStudentToPrivateWorkout(student.id)"
              >
                <div class="student-info">
                  <div class="student-name">{{ student.name }}</div>
                  <div class="student-details">{{ student.cpf }} • {{ student.email }}</div>
                  <div class="student-plan">{{ student.planType }} - {{ student.planDescription }}</div>
                </div>
                <button type="button" class="btn-add-student">+</button>
              </div>
            </div>
            <div class="no-results" *ngIf="getAvailableStudentsForPrivateWorkout().length === 0">
              <span *ngIf="!studentSearch">Todos os alunos já foram selecionados</span>
              <span *ngIf="studentSearch">Nenhum aluno encontrado para "{{ studentSearch }}"</span>
            </div>
          </div>
        </div>
        
        <div class="exercise-selection">
          <h3>Selecionar Exercícios</h3>
          
          <div class="exercise-search">
            <input 
              type="text" 
              class="search-input" 
              placeholder="Buscar exercícios..."
              [(ngModel)]="exerciseSearch"
              name="exerciseSearch"
            >
          </div>
          
          <div class="exercises-list">
            <div 
              *ngFor="let exercise of getFilteredExercises()" 
              class="exercise-item"
              (click)="addExerciseToPrivateWorkout(exercise)"
            >
              <div class="exercise-info">
                <h4>{{ exercise.name }}</h4>
                <p>{{ exercise.muscleGroup }}</p>
              </div>
              <button type="button" class="btn-add-exercise">+</button>
            </div>
          </div>
        </div>
        
        <div class="selected-exercises" *ngIf="newPrivateWorkout.items.length > 0">
          <h3>Exercícios Selecionados</h3>
          <div class="exercise-list">
            <div *ngFor="let item of newPrivateWorkout.items; let i = index" class="exercise-config">
              <div class="exercise-header">
                <h4>{{ getExerciseById(item.exerciseId)?.name }}</h4>
                <button type="button" class="btn-remove" (click)="removeExerciseFromPrivateWorkout(i)">✕</button>
              </div>
              
              <div class="exercise-params">
                <div class="param-group">
                  <label>Séries</label>
                  <input 
                    type="text" 
                    class="param-input" 
                    [(ngModel)]="item.sets"
                    [name]="'sets_' + i"
                  >
                </div>
                
                <div class="param-group">
                  <label>Repetições</label>
                  <input 
                    type="text" 
                    class="param-input" 
                    [(ngModel)]="item.reps"
                    [name]="'reps_' + i"
                  >
                </div>
                
                <div class="param-group">
                  <label>Descanso (seg)</label>
                  <input 
                    type="number" 
                    class="param-input" 
                    [(ngModel)]="item.restSeconds"
                    [name]="'rest_' + i"
                  >
                </div>
              </div>
              
              <div class="param-group full-width">
                <label>Observação</label>
                <input 
                  type="text" 
                  class="param-input" 
                  [(ngModel)]="item.observation"
                  [name]="'obs_' + i"
                  placeholder="Observações opcionais"
                >
              </div>
            </div>
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn-cancel" (click)="closeCreatePrivateWorkoutModal()">
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn-confirm"
            [disabled]="!privateWorkoutForm.form.valid || newPrivateWorkout.items.length === 0 || tempSelectedStudentIds.length === 0"
          >
            Criar Treino Privado
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal para editar treino -->
<div class="modal-overlay" *ngIf="showEditWorkoutModal" (click)="closeEditWorkoutModal()">
  <div class="modal-content create-workout-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Editar Treino</h2>
      <button class="close-btn" (click)="closeEditWorkoutModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <form (ngSubmit)="updateWorkout()" #editWorkoutForm="ngForm">
        <div class="form-group">
          <label for="editWorkoutName">Nome do Treino</label>
          <input 
            type="text" 
            id="editWorkoutName"
            class="form-input" 
            [(ngModel)]="editWorkout.name"
            name="editWorkoutName"
            required
            placeholder="Digite o nome do treino"
          >
        </div>
        
        <div class="form-group">
          <label for="editWorkoutDescription">Descrição</label>
          <textarea 
            id="editWorkoutDescription"
            class="form-textarea" 
            [(ngModel)]="editWorkout.description"
            name="editWorkoutDescription"
            required
            placeholder="Descreva o treino"
            rows="3"
          ></textarea>
        </div>
        
        <div class="exercise-selection">
          <h3>Editar Exercícios</h3>
          
          <div class="exercise-search">
            <input 
              type="text" 
              class="search-input" 
              placeholder="Buscar exercícios..."
              [(ngModel)]="exerciseSearch"
              name="exerciseSearchEdit"
            >
          </div>
          
          <div class="available-exercises">
            <h4>Exercícios Disponíveis</h4>
            <div class="exercises-list">
              <div 
                *ngFor="let exercise of getFilteredExercises()" 
                class="exercise-item selectable"
                (click)="addExerciseToEditWorkout(exercise)"
              >
                <div class="exercise-info">
                  <span class="exercise-name">{{ exercise.name }}</span>
                  <span class="muscle-group">{{ exercise.muscleGroup | titlecase }}</span>
                </div>
                <button type="button" class="btn-add">+</button>
              </div>
            </div>
          </div>
          
          <div class="selected-exercises" *ngIf="editWorkout.items.length > 0">
            <h4>Exercícios Selecionados ({{ editWorkout.items.length }})</h4>
            <div class="workout-exercises">
              <div 
                *ngFor="let item of editWorkout.items; let i = index" 
                class="workout-exercise-item"
              >
                <div class="exercise-order">
                  <button 
                    type="button" 
                    class="btn-order" 
                    (click)="moveExerciseInEdit(i, -1)"
                    [disabled]="i === 0"
                  >↑</button>
                  <span class="order-number">{{ i + 1 }}</span>
                  <button 
                    type="button" 
                    class="btn-order" 
                    (click)="moveExerciseInEdit(i, 1)"
                    [disabled]="i === editWorkout.items.length - 1"
                  >↓</button>
                </div>
                
                <div class="exercise-details">
                  <div class="exercise-name">{{ getExerciseById(item.exerciseId)?.name }}</div>
                  <div class="exercise-params">
                    <div class="param-group">
                      <label>Séries:</label>
                      <input 
                        type="number" 
                        min="1" 
                        [(ngModel)]="item.sets"
                        name="edit_sets_{{i}}"
                        class="param-input"
                        required
                      >
                    </div>
                    <div class="param-group">
                      <label>Reps:</label>
                      <input 
                        type="text" 
                        [(ngModel)]="item.reps"
                        name="edit_reps_{{i}}"
                        class="param-input"
                        placeholder="8-12"
                        required
                      >
                    </div>
                    <div class="param-group">
                      <label>Descanso (s):</label>
                      <input 
                        type="number" 
                        min="0" 
                        [(ngModel)]="item.restSeconds"
                        name="edit_rest_{{i}}"
                        class="param-input"
                        required
                      >
                    </div>
                  </div>
                  <div class="observation-group">
                    <label>Observação:</label>
                    <input 
                      type="text" 
                      [(ngModel)]="item.observation"
                      name="edit_observation_{{i}}"
                      class="param-input"
                      placeholder="Observações opcionais"
                    >
                  </div>
                </div>
                
                <button 
                  type="button" 
                  class="btn-remove" 
                  (click)="removeExerciseFromEditWorkout(i)"
                >×</button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button 
            type="button" 
            class="btn-cancel" 
            (click)="closeEditWorkoutModal()"
          >
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn-update" 
            [disabled]="!editWorkoutForm.valid || editWorkout.items.length === 0"
          >
            Atualizar Treino
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal para gerenciar alunos do treino -->
<div class="modal-overlay" *ngIf="showStudentManagementModal" (click)="closeStudentManagementModal()">
  <div class="modal-content student-management-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Gerenciar Alunos - {{ selectedWorkoutForStudents?.name }}</h2>
      <button class="close-btn" (click)="closeStudentManagementModal()">&times;</button>
    </div>
    
    <div class="modal-body" *ngIf="selectedWorkoutForStudents">
      <!-- Alunos com acesso ao treino -->
      <div class="students-with-access" *ngIf="getTempStudentsFromWorkout().length > 0">
        <h3>Alunos com acesso ({{ getTempStudentsFromWorkout().length }})</h3>
        <div class="students-list-modal">
          <div 
            *ngFor="let student of getTempStudentsFromWorkout()" 
            class="student-item"
          >
            <div class="student-info">
              <div class="student-name">{{ student.name }}</div>
              <div class="student-details">{{ student.cpf }} • {{ student.email }}</div>
            </div>
            <button 
              class="btn-remove-student" 
              (click)="removeStudentFromWorkout(student.id)"
              title="Remover aluno do treino"
            >
              ×
            </button>
          </div>
        </div>
      </div>

      <!-- Buscar e adicionar alunos -->
      <div class="add-students-section">
        <h3>Adicionar Alunos</h3>
        
        <div class="student-search">
          <input 
            type="text" 
            class="search-input" 
            placeholder="Buscar alunos por nome, CPF ou email..."
            [(ngModel)]="studentSearch"
          >
        </div>
        
        <div class="available-students" *ngIf="getAvailableStudents(selectedWorkoutForStudents).length > 0">
          <h4>Alunos disponíveis ({{ getAvailableStudents(selectedWorkoutForStudents).length }})</h4>
          <div class="students-list-modal">
            <div 
              *ngFor="let student of getAvailableStudents(selectedWorkoutForStudents)" 
              class="student-item selectable"
              (click)="addStudentToWorkout(student.id)"
            >
              <div class="student-info">
                <div class="student-name">{{ student.name }}</div>
                <div class="student-details">{{ student.cpf }} • {{ student.email }}</div>
                <div class="student-plan">{{ student.planType }} - {{ student.planDescription }}</div>
              </div>
              <button type="button" class="btn-add-student">+</button>
            </div>
          </div>
        </div>

        <div *ngIf="getAvailableStudents(selectedWorkoutForStudents).length === 0" class="no-students">
          <p *ngIf="studentSearch">Nenhum aluno encontrado para "{{ studentSearch }}"</p>
          <p *ngIf="!studentSearch">Todos os alunos já têm acesso a este treino.</p>
        </div>
      </div>

      <!-- Botões de ação do modal -->
      <div class="modal-actions">
        <button 
          type="button" 
          class="btn-cancel" 
          (click)="closeStudentManagementModal()"
        >
          Cancelar
        </button>
        <button 
          type="button" 
          class="btn-confirm" 
          (click)="confirmStudentChanges()"
        >
          Confirmar Alterações
        </button>
      </div>
    </div>
  </div>
</div>
